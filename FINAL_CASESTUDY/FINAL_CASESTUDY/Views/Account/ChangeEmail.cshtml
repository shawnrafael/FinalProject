@model PasteBookEntity.USER


<div class="form-horizontal">
    <h4>Change Email <span class="glyphicon glyphicon-pencil"></span></h4>
    <hr />

    <div class="form-group">
        <label class="control-label col-sm-4">Your current email address</label>
        <div class="col-sm-8">
            <input type="text" value="@Model.EMAIL_ADDRESS" id="oldEmail" name="oldEmail" class="form-control input-sm" disabled />
        </div>
    </div>

    @using (Html.BeginForm("UpdateNewEmail","Account",FormMethod.Post,new { id = "editEmailForm" }))
    {
        Model.EMAIL_ADDRESS = "";
        <div class="form-group">
            <label class="control-label col-sm-4">Type your new email address</label>
            <div class="col-sm-8">
               
                @Html.TextBoxFor(model=>model.EMAIL_ADDRESS, new { @class = "form-control input-sm", id = "newInputEmail" })
                @Html.ValidationMessageFor(model => model.EMAIL_ADDRESS, "", new { @class = "text-danger" })
                <span class="text-danger"  id = "invalidEmail"></span>
            </div>
        </div>


        Model.PASSWORD = "";

        <div class="form-group">
            <label class="control-label col-sm-4">Type your password</label>
            <div class="col-sm-8">
                @Html.TextBoxFor(model=>model.PASSWORD, new { @class = "form-control input-sm", type = "password", id = "userPassword" })
                @Html.ValidationMessage("errorPassword", new { @class = "text-danger"})
            </div>
        </div>

        <div class="form-group">
            <label class="control-label col-sm-4"></label>
            <div class="col-sm-8">
                <input type="button" id="changeUserEmail" value="Save" class="btn btn-primary" />
            </div>
        </div>

        bool success = (bool)ViewData["success"];
        if (success == true)
        {
            <div class="col-sm-2"></div>
            <div class="alert alert-success col-sm-8" id="successChangeEmail">
                <strong>Success!</strong> Your email address is updated.
            </div>
            <div class="col-sm-2"></div>
        }
    }
</div>

@section scripts{
    @Scripts.Render("~/bundles/jqueryval")

    <script>
        var checkInputEmailUrl = '@Url.Action("CheckEmail", "Account")';

        $(document).ready(function() {
            $('#changeUserEmail').on('click', function () {
                CheckUserEmailExist()
            });

            $('#newInputEmail').bind('blur keydown', function () {
                $('#invalidEmail').hide();
            });
        });

        function CheckUserEmailExist() {
            var data = {
                email: $('#newInputEmail').val()
            }
            $.ajax({
                url: checkInputEmailUrl,
                data: data,
                type: 'POST',
                success: function (data) {
                    if (data.emailExist == true) {
                        $('#successChangeEmail').hide();
                        $('#invalidEmail').text('Email already exist.')
                        $('#invalidEmail').css('display', 'inline');
                    } else {
                        $('#invalidEmail').css('display', 'none');
                        $('#editEmailForm').submit();
                    }

                },
                error: function () {
                    alert("Something went wrong");
                }
            });
        }
    </script>
    }

    



